@model IEnumerable<CoMan.Models.TopicModel>
@using Microsoft.AspNetCore.Authorization
@inject IAuthorizationService AuthorizationService

@{
    ViewData["Title"] = "TopicList";
}

<h1>TopicList</h1>

@if ((await AuthorizationService.AuthorizeAsync(User, "RequireTeacher")).Succeeded)
{
    <p>
        <a asp-action="Create">Add topic</a>
    </p>
}

<table id="topics-table" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
    <thead>
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>StudentLimit</th>
            <th>Status</th>
            <th>AddedDate</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
    </thead>
</table>

@section Scripts {
    <script src="https://cdn.datatables.net/v/bs5/dt-1.13.4/datatables.min.js" asp-append-version="true"></script>
    <script asp-append-version="true">
        var table;

        $(document).ready(function () {
            table = $("#topics-table").DataTable({
                // Design Assets
                stateSave: true,
                autoWidth: true,
                // ServerSide Setups
                processing: true,
                serverSide: true,
                // Paging Setups
                paging: true,
                // Searching Setups
                searching: { regex: true },
                // Ajax Filter
                ajax: {
                    url: "/LoadTable",
                    type: "POST",
                    contentType: "application/json",
                    dataType: "json",
                    data: function (d) {
                        return JSON.stringify(d);
                    }
                },
                // Columns Setups
                columns: [
                    { data: "title" },
                    { data: "authorName" },
                    { data: "studentLimit" },
                    { data: "status" },
                    { data: "addedDate" }
                ],
                // Column Definitions
                columnDefs: [
                    { targets: "no-sort", orderable: false },
                    { targets: "no-search", searchable: false }
                ]
            });
        });
    </script>
}
